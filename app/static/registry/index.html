<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 

<link href="/css/bootstrap-1.1.1.min.css" type="text/css" rel="stylesheet" />
<link href="/css/prettify.css" type="text/css" rel="stylesheet" />
<link href="/css/prettify_desert.css" type="text/css" rel="stylesheet" />
<link href="/css/base.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" src="/js/prettify/prettify.js"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23141359-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<style>
span.project_name {
  color: green;
}
</style>
</head>
<body onload="prettyPrint()">
<div class="content">

  <h1>python-registry</h1>

  <ul class="nav">
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="https://github.com/williballenthin/python-registry">Download</a></li>
    <li><a href="#usage">Usage</a></li>
    <li><a href="doc/Registry.html">Documentation</a></li>
    <li><a href="#testing">Testing</a></li>
    <li><a href="#wanted">Wanted</a></li>
    <li><a href="#license">License</a></li>
    <li><a href="#sources">Sources</a></li>
    <li><a href="#sample">Sample</a></li>
  </ul>


<h2 id="introduction">Introduction</h2>
<span class="project_name">python-registry</span> was originally written by 
<a href="http://www.williballenthin.com">Willi Ballenthin</a>, a 
forensicator who wanted to access the contents of the
Windows Registry from his Linux laptop.  <span class="project_name">python-registry</span>
currently provides read-only access to Windows Registry files,
such as NTUSER.DAT, userdiff, and SOFTWARE.  The 
interface is two-fold: a high-level interface 
suitable for most tasks, and a low level set of parsing 
objects and methods which may be used for advanced study
of the Windows Registry. <span class="project_name">python-registry</span> is written
in pure Python, making it portable across all major platforms.


<h2 id="Download">Download</h2>
<span class="project_name">python-registry</span> can be downloaded at GitHub here: 
<a href="https://github.com/williballenthin/python-registry">Download</a>.


<h2 id="documentation">Documentation</h2>
Static API documentation for <span class="project_name">python-registry</span> can be found here: 
<a href="doc/Registry.html">Documentation</a>.


<h2 id="usage">Usage</h2>
Most users will find the <code>Registry.Registry</code> module most
appropriate.  The module exposes three classes: the <code>Registry</code>,
the <code>RegistryKey</code>, and the <code>RegistryValue</code>.  The <code>Registry</code> organizes
parsing and access to the Windows Registry file.  The 
<code>RegistryKey</code> is a convenient interface into the tree-like 
structure of the Windows Registry.  A <code>RegistryKey</code> may have
children <code>RegistryKeys</code>, and may also have values associated
with it.  A <code>RegistryValue</code> can be thought of as the tuple
(name, datatype, value) associated with a <code>RegistryKey</code>.  
<span class="project_name">python-registry</span> supports all major datatypes, such as RegSZ,
RegDWord, and RegBin.

<h3>Open a Windows Registry file</h3>
Its this easy:
<pre class="prettyprint lang-python">
import sys
from Registry import Registry

reg = Registry.Registry(sys.argv[1])
</pre>

<h3>Print all keys in a Registry</h3>
<pre class="prettyprint lang-python">
def rec(key, depth=0):
    print "\t" * depth + key.path()
    
    for subkey in key.subkeys():
        rec(subkey, depth + 1)

rec(reg.root())
</pre>

<h3>Find a key and print all string values</h3>
<pre class="prettyprint lang-python">
try:
    key = reg.open("SOFTWARE\\Microsoft\\Windows\\Current Version\\Run")
except Registry.RegistryKeyNotFoundException:
    print "Couldn't find Run key. Exiting..."
    sys.exit(-1)

for value in [v for v key.values() \
                   if v.value_type() == Registry.RegSZ or \
                      v.value_type() == Registry.RegExpandSZ]:
    print "%s: %s" % (value.name(), value.value())
</pre>

Advanced users who wish to study the structure of the 
Windows Registry may find the <code>Registry.RegistryParse</code>
module useful.  This module implements all known structures 
of the Windows Registry.


<h2 id="testing">Testing</h2>
<span class="project_name">python-registry</span> was developed using Python 2.6.5 on 
Ubuntu Linux.  More importantly, the package was tested against
a small set of Windows XP SP3 Registry files acquired from
one of the author's virtual machines.  The script
testing/RegTester.py will parse the .reg files exported by 
Microsoft Regedit and compare the values parsed by 
<span class="project_name">python-registry</span>.  This tool can be used to identify 
regressions and deficiencies in the development of
<span class="project_name">python-registry</span>.

<h2 id="wanted">Wanted</h2>
<li> Bug reports. </li>
<li> Feedback. </li>
<br />

<span class="project_name">python-registry</span> was originally developed to scratch one of
the author's itches.  Now he hopes it can be of use to 
someone outside of his lonely NYC apartment.


<h2 id="license">License</h2>
<span class="project_name">python-registry</span> is released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache v2.0 license</a>.


<h2 id="sources">Sources</h2>
Nearly all structure definitions used in <span class="project_name">python-registry</span>
came from one of two sources:
<ol>
<li> WinReg.txt, by B.H., which may be accessed at:
   <a href="http://pogostick.net/~pnh/ntpasswd/WinReg.txt">
     http://pogostick.net/~pnh/ntpasswd/WinReg.txt
   </a></li>
<li> The Windows NT Registry File Format version 0.4, by 
   Timothy D. Morgan, which may be accessed at:
   <a href="http://sentinelchicken.com/data/TheWindowsNTRegistryFileFormat.pdf">
     http://sentinelchicken.com/data/TheWindowsNTRegistryFileFormat.pdf
   </a></li>
</ol>   
Copies of these resources are included in the 
documentation/ directory of the <span class="project_name">python-registry</span> source.



<h2 id="sample">Sample</h2>
The source directory for <span class="project_name">python-registry</span> contains a sample/
subdirectory that contains small programs that use <span class="project_name">python-registry</span>.
For example, <code>regview.py</code> is a read-only clone of Microsoft Window's 
Regedit, implemented in a few hundred lines.

<img src="/img/regview-thumb.png" alt="Screenshot of regview.py" />

Selections of the <code>regview.py</code> source code that are relevant to 
<span class="project_name">python-registry</span> are included below to highlight how the 
module may be used.  The full source code may be viewed at Github:
<a href="https://github.com/williballenthin/python-registry/blob/master/samples/regview.py">
here</a>.

  <pre class="prettyprint lang-python">
import sys
import wx
from Registry import Registry

class DataPanel(wx.Panel):
    """Displays the value of a RegistryValue humanely."""
    def __init__(self, *args, **kwargs):
        ...

    def _format_hex(self, data):
        ...

    def display_value(self, value):
        self._sizer.Clear()
        data_type = value.value_type()

        if data_type == Registry.RegSZ or \              # we can manipulate
                data_type == Registry.RegExpandSZ or \   # string and integer
                data_type == Registry.RegDWord or \      # types as expected
                data_type == Registry.RegQWord:
            view = wx.TextCtrl(self, style=wx.TE_MULTILINE)
            view.SetValue(unicode(value.value()))

        elif data_type == Registry.RegMultiSZ:           # RegMultiSZ is simply
            view = wx.ListCtrl(self, style=wx.LC_LIST)   # a list of strings
            for string in value.value():
                view.InsertStringItem(view.GetItemCount(), string)

        elif data_type == Registry.RegBin or \           # binary data is supported
                data_type == Registry.RegNone:           # and formatted nicely here
            view = wx.TextCtrl(self, style=wx.TE_MULTILINE)
            font = wx.Font(8, wx.SWISS, wx.NORMAL, wx.NORMAL, False, u'Courier')
            view.SetFont(font)
            view.SetValue(self._format_hex(value.value()))            

        self._sizer.Add(view, 1, wx.EXPAND)
        self._sizer.Layout()

    def clear_value(self):
        ...

class ValuesListCtrl(wx.ListCtrl):
    def __init__(self, *args, **kwargs):
        ...

    def clear_values(self):
        ...

    def add_value(self, value):
        n = self.GetItemCount()
        self.InsertStringItem(n, value.name())           # column 1: name (string)
        self.SetStringItem(n, 1, value.value_type_str()) # column 2: type (string)
        self.values[value.name()] = value                

    def get_value(self, valuename):
        """This is merely a cache of the Registry model."""
        return self.values[valuename]

class RegistryTreeCtrl(wx.TreeCtrl):
    def __init__(self, *args, **kwargs):
        ...

    def add_registry(self, registry):
        root_key = registry.root()                      # .root() is the first key
        root_item = self.AddRoot(root_key.name() + "(%s)" % (sys.argv[1]))
        self.SetPyData(root_item, {"key": root_key,
                                   "has_expanded": False})

        if len(root_key.subkeys()) > 0:                 # we can easily get children
            self.SetItemHasChildren(root_item)          # by asking for subkeys

    def _extend(self, item):
        """Lazily build the tree as the user requests nodes"""
        key = self.GetPyData(item)["key"]
        
        for subkey in key.subkeys(): 
            subkey_item = self.AppendItem(item, subkey.name())
            self.SetPyData(subkey_item, {"key": subkey,
                                         "has_expanded": False})

            if len(subkey.subkeys()) > 0:
                self.SetItemHasChildren(subkey_item)

        self.GetPyData(item)["has_expanded"] = True                

    def OnExpandKey(self, event):
        item = event.GetItem()
        ...
        if not self.GetPyData(item)["has_expanded"]:
            self._extend(item)

def _expand_into(dest, src):
    ...

class RegView(wx.Frame):
    def __init__(self, parent, registry):
        ...
        self._tree.add_registry(registry)

    def OnKeySelected(self, event):
        item = event.GetItem()
        ...
        key = self._tree.GetPyData(item)["key"]
        ...
        for value in key.values():                 # values are easily accessed
            self._value_list_view.add_value(value) # as lists, or can be retrieved
                                                   # with .value(name) by name
    def OnValueSelected(self, event):
        ...

if __name__ == '__main__':
    ...
    registry = Registry.Registry(sys.argv[1])

    app = wx.App(False)                            # standard wxPython app
    frame = RegView(None, registry=registry)       # nothing to see here, except
    frame.Show()                                   # easy construction by filename
    app.MainLoop()
  </pre>
</div>
</body>
</html
