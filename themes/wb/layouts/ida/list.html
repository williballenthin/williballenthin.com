{{ partial "header.html" . }}

<body lang="{{ .Site.LanguageCode }}">
  <nav class="container">
    <span class="breadcrumbs">
      <a href="{{ .Site.Home.RelPermalink }}" class="breadcrumb">{{ .Site.Title }}</a>
      
      <!-- Build breadcrumb path based on URL segments -->
      {{ $pathSegments := split (strings.TrimPrefix "/" .RelPermalink) "/" }}
      {{ $currentPath := "" }}
      {{ $site := .Site }}
      {{ $currentPermalink := .RelPermalink }}
      
      {{ range $index, $segment := $pathSegments }}
        {{ if ne $segment "" }}
          {{ $currentPath = printf "%s/%s" $currentPath $segment }}
          {{ $page := $site.GetPage $currentPath }}
          
          <!-- Check if segment is a year (4 digits), month (2 digits), or ida -->
          {{ $isYear := and (eq (len $segment) 4) (strings.HasPrefix $segment "20") }}
          {{ $isMonth := false }}
          {{ if eq (len $segment) 2 }}
            {{ $segmentInt := 0 }}
            {{ if strings.HasPrefix $segment "0" }}
              {{ $segmentInt = int (strings.TrimPrefix $segment "0") }}
            {{ else }}
              {{ $segmentInt = int $segment }}
            {{ end }}
            {{ $isMonth = and (ge $segmentInt 1) (le $segmentInt 12) }}
          {{ end }}
          {{ $isIda := eq $segment "ida" }}
          
          {{ if and $page (not $isYear) (not $isMonth) (not $isIda) }}
            {{ if ne $currentPath $currentPermalink }}
              <a href="{{ $page.RelPermalink }}" class="breadcrumb">{{ $segment }}</a>
            {{ else }}
              <span class="breadcrumb">{{ $segment }}</span>
            {{ end }}
          {{ else }}
            <span class="breadcrumb">{{ $segment }}</span>
          {{ end }}
        {{ end }}
      {{ end }}
    </span>
  </nav>

  <main class="container">
    <div>
      <h1>{{ .Title }}</h1>
      
      {{ with .Content }}
      <div class="content">
        {{ . }}
      </div>
      {{ end }}

      {{ if eq .RelPermalink "/ida/plugins/activity/" }}
      <!-- Group pages by month for the plugin activity listing -->
      {{ $pages := .Site.GetPage "/ida/plugins/activity" }}
      {{ $byMonth := dict }}
      {{ range $pages.RegularPagesRecursive }}
        {{ $monthKey := .Date.Format "2006-01" }}
        {{ $monthName := .Date.Format "January 2006" }}
        {{ $existing := index $byMonth $monthKey }}
        {{ if $existing }}
          {{ $existingPages := $existing.pages }}
          {{ $newPages := $existingPages | append . }}
          {{ $byMonth = merge $byMonth (dict $monthKey (dict "name" $monthName "pages" $newPages)) }}
        {{ else }}
          {{ $byMonth = merge $byMonth (dict $monthKey (dict "name" $monthName "pages" (slice .))) }}
        {{ end }}
      {{ end }}

      <!-- Extract and sort month keys in descending order -->
      {{ $monthKeys := slice }}
      {{ range $monthKey, $monthData := $byMonth }}
        {{ $monthKeys = $monthKeys | append $monthKey }}
      {{ end }}
      {{ $sortedMonthKeys := sort $monthKeys "" "desc" }}
      
      {{ range $monthKey := $sortedMonthKeys }}
        {{ $monthData := index $byMonth $monthKey }}
        {{ $sortedPages := sort $monthData.pages ".Date" "desc" }}
        <h2>{{ $monthData.name }}</h2>
        <ul class="content-list">
          {{ range $sortedPages }}
          <li>
            <a href="{{ .RelPermalink}}" class="entry-link">{{ .Date.Format "January 2, 2006" }}</a>
          </li>
          {{ end }}
        </ul>
      {{ end }}

      {{ else }}
      <!-- For other ida sections, show regular listing -->
      {{ if .Pages }}
      <ul class="content-list">
        {{ range .Pages.ByDate.Reverse }}
        <li>
          <a href="{{ .RelPermalink}}" class="entry-link">{{ .Title }}</a><br/>
          <span class="date">{{ .Date.Format "January 2, 2006" }}</span>
        </li>
        {{ end }}
      </ul>
      {{ end }}

      {{ if .Sections }}
      <h2>Browse by Section</h2>
      <ul class="content-list">
        {{ range .Sections.ByTitle }}
        <li>
          <a href="{{ .RelPermalink}}" class="entry-link">{{ .Title }}</a>
        </li>
        {{ end }}
      </ul>
      {{ end }}
      {{ end }}
    </div>
  </main>

  {{ partial "footer.html" . }}
  </body>

<!-- layout: ida/list.html -->
</html>