---
title: "Biodiff"
date: 2022-03-06T00:00:00-07:00
draft: false
---

[biodiff](https://github.com/8051Enthusiast/biodiff) is a binary diffing tool by [@8051enthusiast](https://twitter.com/8051enthusiast).
You can use this tool to identify additions, removals, and changes between two files, even if they're not text files.
I anticipate this to be useful during malware analysis, such as to highlight configuration changes among variants of the same malware family.

In the past, I've used [010 Editor](https://www.sweetscape.com/010editor/) for this; however, it requires a lot of pointy-clicky GUI interactions.
biodiff may be a better fit for strictly diff-ing within a terminal.


### example: finding malware configuration changes

Imagine you've recovered two similar-looking malware payloads during an incident:
  - [virus.exe](https://www.virustotal.com/gui/file/bd960ceb2ea4dc5f16988120d8e710a7f7e7990a7adf51c3292aa64f1bc20061)
  - [hacker.exe](https://www.virustotal.com/gui/file/6614fcdf514992b7199d7e6643b924ad340ccd258dcd4779a4b330e4a80bad2a)


| filename    | size (bytes) | magic                                         |
| ----------- | ------------ | --------------------------------------------- |
| virus.exe   | 7168         | PE32+ executable (GUI) x86-64, for MS Windows |
| hacker.exe  | 7168         | PE32+ executable (GUI) x86-64, for MS Windows |

You do a quick triage and see that they have a similar structure, by using `objdump` to enumerate sections, etc. and comparing the reports:

![image alt text](/img/biodiff3.jpg)

This shows two differences:
  - the PE header checksum
  - the first section name

However, `diff objdump` doesn't explain if/how the code differs.

You can approximate a content comparison by diffing the strings of the two files, but there are obvious reasons why this doesn't work well:
it only considers data with a human-readable representation, etc.

![image alt text](/img/biodiff3.jpg)

This is a perfect time to use `biodiff`:

![image alt text](/img/biodiff1.jpg)

biodiff displays hex dumps of the two files side-by-side and highlights changes.
It found three differencess:

  1. PE header checksum (known)
  2. the second section's name (known)
  3. six code changes around offset 0x1810 (new!)

Here are the changes within the code region:

![image alt text](/img/biodiff4.jpg)

Of those, the first five are instruction reorderings that we can ignore:

![image alt text](/img/biodiff5.jpg)

and the final is a meaningful change of an immediate constant:

![image alt text](/img/biodiff6.jpg)



```c
struct sockaddr_in {
        short   sin_family;  // 0x2 == IPPROTO_TCP
        u_short sin_port;
        struct  in_addr sin_addr;
        char    sin_zero[8];
};
```

11 5C C0 A8 01 21


>>> f"{0xC0}.{0xA8}.{0x01}.{0x21}"
'192.168.1.33'
>>> f"{0x5C11}"
'23569'


>>>  5b 26 2f 5f 0d a8
  File "<stdin>", line 1
    5b 26 2f 5f 0d a8
    ^
IndentationError: unexpected indent
>>> f"{0x2F}.{0x5F}.{0x0D}.{0xA8}"
'47.95.13.168'
>>> f"{0x265B}"
'9819'
